<!DOCTYPE html>
<html>
<head>
  <title>Dodge the Falling Blocks</title>
  <style>
    /* Basic styling to center the canvas and set a dark background */
    body {
      margin: 0;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      background-color: #222;
      border: 2px solid #fff;
    }
    /* Game over message styling */
    #gameOver {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 36px;
      text-align: center;
      display: none;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="500" height="500"></canvas>
  <div id="gameOver">Game Over!<br>Press F5 to Restart</div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Game state variables
    let gameOver = false;
    let score = 0;
    let obstacleTimer = 0;
    let obstacleInterval = 60; // Frames between obstacle spawns

    // Define the player object
    const player = {
      x: canvas.width / 2 - 15,
      y: canvas.height - 40,
      width: 30,
      height: 30,
      speed: 5
    };

    // Array to hold falling obstacles
    let obstacles = [];

    // Object to track keyboard input
    const keys = {
      ArrowLeft: false,
      ArrowRight: false
    };

    // Listen for key press events to move the player
    document.addEventListener("keydown", function(e) {
      if (e.code === "ArrowLeft" || e.code === "ArrowRight") {
        keys[e.code] = true;
      }
    });

    document.addEventListener("keyup", function(e) {
      if (e.code === "ArrowLeft" || e.code === "ArrowRight") {
        keys[e.code] = false;
      }
    });

    // Function to spawn a new falling obstacle with random size and speed
    function spawnObstacle() {
      const width = Math.random() * 30 + 20;   // Width between 20 and 50
      const height = Math.random() * 20 + 20;    // Height between 20 and 40
      const x = Math.random() * (canvas.width - width);
      const y = -height;
      const speed = Math.random() * 2 + 2;         // Speed between 2 and 4
      obstacles.push({ x, y, width, height, speed });
    }

    // Check for collision between two rectangles
    function rectIntersect(r1, r2) {
      return !(r2.x > r1.x + r1.width || 
               r2.x + r2.width < r1.x || 
               r2.y > r1.y + r1.height ||
               r2.y + r2.height < r1.y);
    }

    // Update game objects and check for collisions
    function update() {
      if (gameOver) return;

      // Move player left/right based on input
      if (keys.ArrowLeft) {
        player.x -= player.speed;
      }
      if (keys.ArrowRight) {
        player.x += player.speed;
      }
      // Keep the player within the canvas boundaries
      if (player.x < 0) player.x = 0;
      if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

      // Spawn new obstacles at intervals
      obstacleTimer++;
      if (obstacleTimer > obstacleInterval) {
        spawnObstacle();
        obstacleTimer = 0;
        // Gradually increase difficulty by reducing the interval (down to a limit)
        if (obstacleInterval > 20) {
          obstacleInterval--;
        }
      }

      // Update each obstacle's position
      obstacles.forEach(obs => {
        obs.y += obs.speed;
      });

      // Remove obstacles that have moved off the bottom of the canvas
      obstacles = obstacles.filter(obs => obs.y < canvas.height);

      // Check for collisions between the player and obstacles
      for (let obs of obstacles) {
        if (rectIntersect(player, obs)) {
          gameOver = true;
          document.getElementById("gameOver").style.display = "block";
          break;
        }
      }

      // Increase score over time (you can adjust this as desired)
      score++;

      // Continue the game loop
      requestAnimationFrame(draw);
    }

    // Draw all game objects onto the canvas
    function draw() {
      // Clear the canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw the player as a green square
      ctx.fillStyle = "#0f0";
      ctx.fillRect(player.x, player.y, player.width, player.height);

      // Draw all obstacles as red rectangles
      ctx.fillStyle = "#f00";
      obstacles.forEach(obs => {
        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
      });

      // Draw the current score in white
      ctx.fillStyle = "#fff";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + score, 10, 30);

      // Continue updating if the game is still active
      if (!gameOver) {
        update();
      }
    }

    // Start the game loop
    requestAnimationFrame(draw);
  </script>
</body>
</html>
